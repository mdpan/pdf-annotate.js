{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b65958fac83e5c85007d","webpack:///./index.js","webpack:///./src/PDFJSAnnotate.js","webpack:///./src/adapter/StoreAdapter.js","webpack:///./src/utils/abstractFunction.js","webpack:///./src/UI/event.js","webpack:///./~/events/events.js","webpack:///./src/UI/utils.js","webpack:///./~/create-stylesheet/index.js","webpack:///./src/adapter/LocalStoreAdapter.js","webpack:///./src/utils/uuid.js","webpack:///./src/render/index.js","webpack:///./src/render/appendChild.js","webpack:///./~/object-assign/index.js","webpack:///./src/render/renderLine.js","webpack:///./src/utils/setAttributes.js","webpack:///./src/utils/normalizeColor.js","webpack:///./src/render/renderPath.js","webpack:///./src/render/renderPoint.js","webpack:///./src/render/renderRect.js","webpack:///./src/render/renderText.js","webpack:///./src/render/renderSign.js","webpack:///./src/render/renderSignImg.js","webpack:///./src/a11y/renderScreenReaderHints.js","webpack:///./src/a11y/insertScreenReaderHint.js","webpack:///./src/a11y/createScreenReaderOnly.js","webpack:///./src/a11y/insertElementWithinChildren.js","webpack:///./src/a11y/insertElementWithinElement.js","webpack:///./src/a11y/renderScreenReaderComments.js","webpack:///./src/a11y/insertScreenReaderComment.js","webpack:///./src/a11y/initEventHandlers.js","webpack:///./src/UI/index.js","webpack:///./src/UI/edit.js","webpack:///./src/UI/pen.js","webpack:///./src/UI/point.js","webpack:///./src/UI/rect.js","webpack:///./src/UI/text.js","webpack:///./src/UI/page.js","webpack:///./src/UI/signature.js","webpack:///./src/UI/signimg.js"],"names":["PDFJSAnnotate","StoreAdapter","LocalStoreAdapter","__storeAdapter","getStoreAdapter","setStoreAdapter","adapter","UI","render","getAnnotations","documentId","pageNumber","arguments","definition","Object","keys","forEach","key","annotationId","annotation","content","commentId","__getAnnotations","fn","then","annotations","a","__addAnnotation","addAnnotation","__editAnnotation","editAnnotation","__deleteAnnotation","deleteAnnotation","success","__addComment","addComment","comment","__deleteComment","deleteComment","abstractFunction","name","Error","fireEvent","addEventListener","removeEventListener","emitter","EventEmitter","clickNode","document","handleDocumentClick","e","clientX","clientY","target","emit","on","removeListener","findSVGContainer","findSVGAtPoint","findAnnotationAtPoint","pointIntersectsRect","getOffsetAnnotationRect","getAnnotationRect","scaleUp","scaleDown","getScroll","getOffset","disableUserSelect","enableUserSelect","getMetadata","BORDER_COLOR","userSelectStyleSheet","body","setAttribute","node","parentNode","nodeName","toUpperCase","getAttribute","x","y","elements","querySelectorAll","i","l","length","el","rect","getBoundingClientRect","svg","top","bottom","left","right","offsetLeft","offsetTop","h","w","LINE_OFFSET","toLowerCase","minX","maxX","minY","maxY","replace","split","splice","p","s","map","parseInt","height","width","result","includes","viewport","scale","scrollTop","scrollLeft","head","appendChild","removeChild","JSON","parse","Promise","resolve","reject","filter","page","class","getAnnotation","findAnnotation","uuid","push","updateAnnotations","index","getComments","localStorage","getItem","setItem","stringify","REGEXP","PATTERN","replacement","c","r","Math","random","v","toString","data","innerHTML","removeAttribute","Array","isArray","isFirefox","test","navigator","userAgent","getTranslation","rotation","transform","trans","flg","querySelector","path","n","xsi","ysi","widthsi","heightsi","image","xi","yi","widthi","heighti","text","svgrect","xst","yst","widthst","heightst","widthr","heightr","child","type","color","renderLine","group","createElementNS","stroke","strokeWidth","rectangles","line","x1","y1","x2","y2","setAttributes","UPPER_REGEX","BLACKLIST","keyCase","indexOf","match","attributes","normalizeColor","REGEX_HASHLESS_HEX","renderPath","d","lines","p1","p2","join","fill","renderPoint","SIZE","D","outerSVG","innerSVG","viewBox","renderRect","fillOpacity","createRect","renderText","size","fontSize","renderSign","renderSignImg","img","href","renderScreenReaderHints","SORT_TYPES","sortBy","sort","sortByPoint","b","sortByRectPoint","sortByLinePoint","lineA","lineB","insertScreenReaderHint","COMMENT_TYPES","num","rects","first","last","createScreenReaderOnly","createElement","createTextNode","style","position","overflow","insertElementWithinChildren","nodes","insertBefore","textLayer","textRect","insertElementWithinElement","OFFSET_ADJUST","max","textLayerElementFromPoint","temp","cloneNode","tail","unshift","pop","outerHTML","renderScreenReaderComments","comments","promise","getElementById","list","insertScreenReaderComment","item","initEventHandlers","reorderAnnotationsByType","removeAnnotation","insertComment","removeComment","removeElementById","elementId","disableEdit","enableEdit","disablePen","enablePen","setPen","disablePoint","enablePoint","setPoint","disableRect","enableRect","disableText","enableText","setText","disableSignature","enableSignature","disableSignimg","enableSignimg","createPage","renderPage","_enabled","isDragging","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","OVERLAY_BORDER_SIZE","createEditOverlay","destroyEditOverlay","anchor","id","styleLeft","styleTop","boxSizing","background","border","borderRadius","padding","textAlign","textDecoration","spantextarea","value","rows","inputDocumentClick","spaninput","textSize","inputDocumentClickS","handleDocumentKeyup","handleDocumentMousedown","borderColor","boxShadow","display","handleDocumentMousemove","handleDocumentMouseup","_getMetadata","stopPropagation","val","$","attr","click","keyCode","cursor","offsetHeight","offsetWidth","getDelta","propX","propY","calcDelta","deltaX","deltaY","t","modelY","viewY","modelX","viewX","originX","originY","setTimeout","handleAnnotationClick","_penSize","_penColor","savePoint","point","penSize","penColor","_pointColor","input","zIndex","handleInputBlur","focus","handleInputKeyup","closeInput","trim","assign","undefined","_type","getSelectionRects","selection","window","getSelection","range","getRangeAt","getClientRects","saveRect","removeAllRanges","boundingRect","offset","_textSize","_textColor","saveText","textColor","PAGE_TEMPLATE","children","canvas","mozOpaque","renderOptions","pdfDocument","rotate","all","getPage","pdfPage","canvasContext","getContext","alpha","getViewport","scalePage","getTextContent","normalizeWhitespace","textContent","textLayerFactory","PDFJS","DefaultTextLayerFactory","textLayerBuilder","createTextLayerBuilder","setTextContent","context","wrapper","outputScale","getOutputScale","scaled","sx","sy","sfx","approximateFraction","sfy","visibility","roundToDivide","floor","xinv","limit","x_","q","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","div","round","signatureFun","_svg"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,gBAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH,qBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;SCzRgB6C,gB,GAAAA,gB;SAqBAC,c,GAAAA,c;SAuBAC,qB,GAAAA,qB;SAwBAC,mB,GAAAA,mB;SAUAC,uB,GAAAA,uB;SAiBAC,iB,GAAAA,iB;SA8FAC,O,GAAAA,O;SAkBAC,S,GAAAA,S;SAiBAC,S,GAAAA,S;SAoBAC,S,GAAAA,S;SAkBAC,iB,GAAAA,iB;SAUAC,gB,GAAA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","file":"dist/pdf-annotate.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b65958fac83e5c85007d","import PDFJSAnnotate from './src/PDFJSAnnotate';\r\n\r\nexport default PDFJSAnnotate;\r\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import StoreAdapter from './adapter/StoreAdapter';\r\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\r\nimport render from './render';\r\nimport UI from './UI';\r\n\r\nexport default {\r\n  /**\r\n   * Abstract class that needs to be defined so PDFJSAnnotate\r\n   * knows how to communicate with your server.\r\n   */\r\n  StoreAdapter,\r\n\r\n  /**\r\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\r\n   */\r\n  LocalStoreAdapter,\r\n\r\n  /**\r\n   * Abstract instance of StoreAdapter\r\n   */\r\n  __storeAdapter: new StoreAdapter(),\r\n\r\n  /**\r\n   * Getter for the underlying StoreAdapter property\r\n   *\r\n   * @return {StoreAdapter}\r\n   */\r\n  getStoreAdapter() {\r\n    return this.__storeAdapter;\r\n  },\r\n\r\n  /**\r\n   * Setter for the underlying StoreAdapter property\r\n   *\r\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\r\n   */\r\n  setStoreAdapter(adapter) {\r\n    // TODO this throws an error when bundled\r\n    // if (!(adapter instanceof StoreAdapter)) {\r\n    //   throw new Error('adapter must be an instance of StoreAdapter');\r\n    // }\r\n\r\n    this.__storeAdapter = adapter;\r\n  },\r\n\r\n  /**\r\n   * UI is a helper for instrumenting UI interactions for creating,\r\n   * editing, and deleting annotations in the browser.\r\n   */\r\n  UI,\r\n\r\n  /**\r\n   * Render the annotations for a page in the PDF Document\r\n   *\r\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\r\n   * @param {PageViewport} viewport The PDFPage.getViewport data\r\n   * @param {Object} data The StoreAdapter.getAnnotations data\r\n   * @return {Promise}\r\n   */\r\n  render,\r\n\r\n  /**\r\n   * Convenience method for getting annotation data\r\n   *\r\n   * @alias StoreAdapter.getAnnotations\r\n   * @param {String} documentId The ID of the document\r\n   * @param {String} pageNumber The page number\r\n   * @return {Promise}\r\n   */\r\n  getAnnotations(documentId, pageNumber) {\r\n    return this.getStoreAdapter().getAnnotations(...arguments);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/PDFJSAnnotate.js","import abstractFunction from '../utils/abstractFunction';\r\nimport { fireEvent } from '../UI/event';\r\n\r\n// Adapter should never be invoked publicly\r\nexport default class StoreAdapter {\r\n  /**\r\n   * Create a new StoreAdapter instance\r\n   *\r\n   * @param {Object} [definition] The definition to use for overriding abstract methods\r\n   */\r\n  constructor(definition = {}) {\r\n    // Copy each function from definition if it is a function we know about\r\n    Object.keys(definition).forEach((key) => {\r\n      if (typeof definition[key] === 'function' &&\r\n          typeof this[key] === 'function') {\r\n        this[key] = definition[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all the annotations for a given document and page number.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotations belong to\r\n   * @param {Number} pageNumber The number of the page the annotations belong to\r\n   * @return {Promise}\r\n   */\r\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\r\n  get getAnnotations() { return this.__getAnnotations; }\r\n  set getAnnotations(fn) {\r\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\r\n      return fn(...arguments).then((annotations) => {\r\n        // TODO may be best to have this happen on the server\r\n        if (annotations.annotations) {\r\n          annotations.annotations.forEach((a) => {\r\n            a.documentId = documentId;\r\n          });\r\n        }\r\n        return annotations;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the definition for a specific annotation.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotation belongs to\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\r\n\r\n  /**\r\n   * Add an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document to add the annotation to\r\n   * @param {String} pageNumber The page number to add the annotation to\r\n   * @param {Object} annotation The definition for the new annotation\r\n   * @return {Promise}\r\n   */\r\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\r\n  get addAnnotation() { return this.__addAnnotation; }\r\n  set addAnnotation(fn) {\r\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Edit an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} pageNumber the page number of the annotation\r\n   * @param {Object} annotation The definition of the modified annotation\r\n   * @return {Promise}\r\n   */\r\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\r\n  get editAnnotation() { return this.__editAnnotation; }\r\n  set editAnnotation(fn) {\r\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\r\n  get deleteAnnotation() { return this.__deleteAnnotation; }\r\n  set deleteAnnotation(fn) {\r\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('annotation:delete', documentId, annotationId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all the comments for an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\r\n\r\n  /**\r\n   * Add a new comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @param {Object} content The definition of the comment\r\n   * @return {Promise}\r\n   */\r\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\r\n  get addComment() { return this.__addComment; }\r\n  set addComment(fn) {\r\n    this.__addComment = function addComment(documentId, annotationId, content) {\r\n      return fn(...arguments).then((comment) => {\r\n        fireEvent('comment:add', documentId, annotationId, comment);\r\n        return comment;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} commentId The ID for the comment\r\n   * @return {Promise}\r\n   */\r\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\r\n  get deleteComment() { return this.__deleteComment; }\r\n  set deleteComment(fn) {\r\n    this.__deleteComment = function deleteComment(documentId, commentId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('comment:delete', documentId, commentId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/adapter/StoreAdapter.js","/**\r\n * Throw an Error for an abstract function that hasn't been implemented.\r\n *\r\n * @param {String} name The name of the abstract function\r\n */\r\nexport default function abstractFunction(name) {\r\n  throw new Error(name + ' is not implemented');\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/abstractFunction.js","import EventEmitter from 'events';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGAtPoint\r\n} from './utils';\r\n\r\nconst emitter = new EventEmitter;\r\n\r\nlet clickNode;\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\ndocument.addEventListener('click', function handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n\r\n  // Emit annotation:blur if clickNode is no longer clicked\r\n  if (clickNode && clickNode !== target) {\r\n    emitter.emit('annotation:blur', clickNode);\r\n  }\r\n\r\n  // Emit annotation:click if target was clicked\r\n  if (target) {\r\n    emitter.emit('annotation:click', target);\r\n  }\r\n\r\n  clickNode = target;\r\n});\r\n\r\n// let mouseOverNode;\r\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\r\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n//\r\n//   // Emit annotation:mouseout if target was mouseout'd\r\n//   if (mouseOverNode && !target) {\r\n//     emitter.emit('annotation:mouseout', mouseOverNode);\r\n//   }\r\n//\r\n//   // Emit annotation:mouseover if target was mouseover'd\r\n//   if (target && mouseOverNode !== target) {\r\n//     emitter.emit('annotation:mouseover', target);\r\n//   }\r\n//\r\n//   mouseOverNode = target;\r\n// });\r\n\r\nexport function fireEvent() { emitter.emit(...arguments); };\r\nexport function addEventListener() { emitter.on(...arguments); };\r\nexport function removeEventListener() { emitter.removeListener(...arguments); };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/event.js","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 5\n// module chunks = 0","import createStyleSheet from 'create-stylesheet';\r\n\r\nexport const BORDER_COLOR = '#00BFFF';\r\n\r\nconst userSelectStyleSheet = createStyleSheet({\r\n  body: {\r\n    '-webkit-user-select': 'none',\r\n       '-moz-user-select': 'none',\r\n        '-ms-user-select': 'none',\r\n            'user-select': 'none'\r\n  }\r\n});\r\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\r\n\r\n/**\r\n * Find the SVGElement that contains all the annotations for a page\r\n *\r\n * @param {Element} node An annotation within that container\r\n * @return {SVGElement} The container SVG or null if it can't be found\r\n */\r\nexport function findSVGContainer(node) {\r\n  let parentNode = node;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\r\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\r\n      return parentNode;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an SVGElement container at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {SVGElement} The container SVG or null if one can't be found\r\n */\r\nexport function findSVGAtPoint(x, y) {\r\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\r\n\r\n  for (let i=0, l=elements.length; i<l; i++) {\r\n    let el = elements[i];\r\n    let rect = el.getBoundingClientRect();\r\n\r\n    if (pointIntersectsRect(x, y, rect)) {\r\n\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an Element that represents an annotation at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {Element} The annotation element or null if one can't be found\r\n */\r\nexport function findAnnotationAtPoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) { return; }\r\n  let elements = svg.querySelectorAll('[data-pdf-annotate-type]');\r\n\r\n  // Find a target element within SVG\r\n  for (let i=0, l=elements.length; i<l; i++) {\r\n    let el = elements[i];\r\n    if (pointIntersectsRect(x, y, getOffsetAnnotationRect(el))) {   \r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Determine if a point intersects a rect\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\r\n * @return {Boolean} True if a collision occurs, otherwise false\r\n */\r\nexport function pointIntersectsRect(x, y, rect) {\r\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element accounting for offset.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getOffsetAnnotationRect(el) {\r\n  let rect = getAnnotationRect(el);\r\n  let { offsetLeft, offsetTop } = getOffset(el);\r\n  return {\r\n    top: rect.top + offsetTop,\r\n    left: rect.left + offsetLeft,\r\n    right: rect.right + offsetLeft,\r\n    bottom: rect.bottom + offsetTop\r\n  };\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getAnnotationRect(el) {\r\n  let h = 0, w = 0, x = 0, y = 0;\r\n  let rect = el.getBoundingClientRect();\r\n  // TODO this should be calculated somehow\r\n  const LINE_OFFSET = 16;\r\n\r\n  switch (el.nodeName.toLowerCase()) {\r\n    case 'path':\r\n    let minX, maxX, minY, maxY;\r\n\r\n    el.getAttribute('d').replace(/Z/, '').split('M').splice(1).forEach((p) => {\r\n      var s = p.split(' ').map(i => parseInt(i, 10));\r\n\r\n      if (typeof minX === 'undefined' || s[0] < minX) { minX = s[0]; }\r\n      if (typeof maxX === 'undefined' || s[2] > maxX) { maxX = s[2]; }\r\n      if (typeof minY === 'undefined' || s[1] < minY) { minY = s[1]; }\r\n      if (typeof maxY === 'undefined' || s[3] > maxY) { maxY = s[3]; }\r\n    });\r\n\r\n    h = maxY - minY;\r\n    w = maxX - minX;\r\n    x = minX;\r\n    y = minY;\r\n    break;\r\n\r\n    case 'line':\r\n    h = parseInt(el.getAttribute('y2'), 10) - parseInt(el.getAttribute('y1'), 10);\r\n    w = parseInt(el.getAttribute('x2'), 10) - parseInt(el.getAttribute('x1'), 10);\r\n    x = parseInt(el.getAttribute('x1'), 10);\r\n    y = parseInt(el.getAttribute('y1'), 10);\r\n\r\n    if (h === 0) {\r\n      h += LINE_OFFSET;\r\n      y -= (LINE_OFFSET / 2);\r\n    }\r\n    break;\r\n\r\n    case 'text':\r\n    h = rect.height;\r\n    w = rect.width;\r\n    x = parseInt(el.getAttribute('x'), 10);\r\n    y = parseInt(el.getAttribute('y'), 10) - h;\r\n    break;\r\n\r\n    case 'g':\r\n    let { offsetLeft, offsetTop } = getOffset(el);\r\n    h = rect.height;\r\n    w = rect.width;\r\n    x = rect.left - offsetLeft;\r\n    y = rect.top - offsetTop;\r\n\r\n    if (el.getAttribute('data-pdf-annotate-type') === 'strikeout') {\r\n      h += LINE_OFFSET;\r\n      y -= (LINE_OFFSET / 2);\r\n    }\r\n    break;\r\n\r\n    case 'rect':\r\n    case 'svg':\r\n    h = parseInt(el.getAttribute('height'), 10);\r\n    w = parseInt(el.getAttribute('width'), 10);\r\n    x = parseInt(el.getAttribute('x'), 10);\r\n    y = parseInt(el.getAttribute('y'), 10);\r\n    break;\r\n  }\r\n\r\n  // Result provides same properties as getBoundingClientRect\r\n  let result = {\r\n    top: y,\r\n    left: x,\r\n    width: w,\r\n    height: h,\r\n    right: x + w,\r\n    bottom: y + h\r\n  };\r\n\r\n  // For the case of nested SVG (point annotations) and grouped\r\n  // lines or rects no adjustment needs to be made for scale.\r\n  // I assume that the scale is already being handled\r\n  // natively by virtue of the `transform` attribute.\r\n  if (!['svg', 'g'].includes(el.nodeName.toLowerCase())) {\r\n    result = scaleUp(findSVGAtPoint(rect.left, rect.top), result);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Adjust scale from normalized scale (100%) to rendered scale.\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled up\r\n */\r\nexport function scaleUp(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] * viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Adjust scale from rendered scale to a normalized scale (100%).\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled down\r\n */\r\nexport function scaleDown(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] / viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get the scroll position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the scroll position for\r\n * @return {Object} The scrollTop and scrollLeft position\r\n */\r\nexport function getScroll(el) {\r\n  let scrollTop = 0;\r\n  let scrollLeft = 0;\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    scrollTop += parentNode.scrollTop;\r\n    scrollLeft += parentNode.scrollLeft;\r\n  }\r\n\r\n  return { scrollTop, scrollLeft };\r\n}\r\n\r\n/**\r\n * Get the offset position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the offset position for\r\n * @return {Object} The offsetTop and offsetLeft position\r\n */\r\nexport function getOffset(el) {\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\r\n      break;\r\n    }\r\n  }\r\n\r\n  let rect = parentNode.getBoundingClientRect();\r\n\r\n  return { offsetLeft: rect.left, offsetTop: rect.top };\r\n}\r\n\r\n/**\r\n * Disable user ability to select text on page\r\n */\r\nexport function disableUserSelect() {\r\n  if (!userSelectStyleSheet.parentNode) {\r\n    document.head.appendChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Enable user ability to select text on page\r\n */\r\nexport function enableUserSelect() {\r\n  if (userSelectStyleSheet.parentNode) {\r\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the metadata for a SVG container\r\n *\r\n * @param {SVGElement} svg The SVG container to get metadata for\r\n */\r\nexport function getMetadata(svg) {\r\n  return {\r\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\r\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\r\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/utils.js","module.exports = function createStyleSheet(blocks) {\n  var style = document.createElement('style');\n  var text = Object.keys(blocks).map(function (selector) {\n    return processRuleSet(selector, blocks[selector]);\n  }).join('\\n');\n  \n  style.setAttribute('type', 'text/css');\n  style.appendChild(document.createTextNode(text));\n\n  return style;\n}\n\nfunction processRuleSet(selector, block) {\n  return selector + ' {\\n' + processDeclarationBlock(block) + '\\n}';\n}\n\nfunction processDeclarationBlock(block) {\n  return Object.keys(block).map(function (prop) {\n    return processDeclaration(prop, block[prop]);\n  }).join('\\n');\n}\n\nfunction processDeclaration(prop, value) {\n  if (!isNaN(value) && value != 0) {\n    value = value + 'px';\n  }\n\n  return hyphenate(prop) + ': ' + value + ';';\n}\n\nfunction hyphenate(prop) {\n  return prop.replace(/[A-Z]/g, function (match) {\n    return '-' + match.toLowerCase();\n  });\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/create-stylesheet/index.js\n// module id = 7\n// module chunks = 0","import uuid from '../utils/uuid';\r\nimport StoreAdapter from './StoreAdapter';\r\n\r\n// StoreAdapter for working with localStorage\r\n// This is ideal for testing, examples, and prototyping\r\nexport default class LocalStoreAdapter extends StoreAdapter {\r\n  constructor() {\r\n    super({\r\n      getAnnotations(documentId, pageNumber) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId).filter((i) => {\r\n            return i.page === pageNumber && i.class === 'Annotation';\r\n          });\r\n\r\n          resolve({\r\n            documentId,\r\n            pageNumber,\r\n            annotations\r\n          });\r\n        });\r\n      },\r\n\r\n      getAnnotation(documentId, annotationId) {\r\n        return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\r\n      },\r\n\r\n      addAnnotation(documentId, pageNumber, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          annotation.class = 'Annotation';\r\n          annotation.uuid = uuid();\r\n          annotation.page = pageNumber;\r\n\r\n          let annotations = getAnnotations(documentId);\r\n          annotations.push(annotation);\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      editAnnotation(documentId, annotationId, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId);\r\n          annotations[findAnnotation(documentId, annotationId)] = annotation;\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      deleteAnnotation(documentId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          let index = findAnnotation(documentId, annotationId);\r\n          if (index > -1) {\r\n            let annotations = getAnnotations(documentId);\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      },\r\n\r\n      getComments(documentId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          resolve(getAnnotations(documentId).filter((i) => {\r\n            return i.class === 'Comment' && i.annotation === annotationId;\r\n          }));\r\n        });\r\n      },\r\n\r\n      addComment(documentId, annotationId, content) {\r\n        return new Promise((resolve, reject) => {\r\n          let comment = {\r\n            class: 'Comment',\r\n            uuid: uuid(),\r\n            annotation: annotationId,\r\n            content: content\r\n          };\r\n\r\n          let annotations = getAnnotations(documentId);\r\n          annotations.push(comment);\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(comment);\r\n        });\r\n      },\r\n\r\n      deleteComment(documentId, commentId) {\r\n        return new Promise((resolve, reject) => {\r\n          getAnnotations(documentId);\r\n          let index = -1;\r\n          let annotations = getAnnotations(documentId);\r\n          for (let i=0, l=annotations.length; i<l; i++) {\r\n            if (annotations[i].uuid === commentId) {\r\n              index = i;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (index > -1) {\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction getAnnotations(documentId) {\r\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\r\n}\r\n\r\nfunction updateAnnotations(documentId, annotations) {\r\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\r\n}\r\n\r\nfunction findAnnotation(documentId, annotationId) {\r\n  let index = -1;\r\n  let annotations = getAnnotations(documentId);\r\n  for (let i=0, l=annotations.length; i<l; i++) {\r\n    if (annotations[i].uuid === annotationId) {\r\n      index = i;\r\n      break;\r\n    }\r\n  }\r\n  return index;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/adapter/LocalStoreAdapter.js","const REGEXP = /[xy]/g\r\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\r\n\r\nfunction replacement(c) {\r\n  let r = Math.random()*16|0;\r\n  let v = c == 'x' ? r : (r&0x3|0x8);\r\n  return v.toString(16);\r\n}\r\n\r\n/**\r\n * Generate a univierally unique identifier\r\n *\r\n * @return {String}\r\n */\r\nexport default function uuid() {\r\n  return PATTERN.replace(REGEXP, replacement);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/uuid.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from './appendChild';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n/**\r\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\r\n *\r\n * @param {SVGElement} svg The SVG element to render the annotations to\r\n * @param {Object} viewport The page viewport data\r\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: SVGElement\r\n *    - rejected: Error\r\n */\r\nexport default function render(svg, viewport, data) {\r\n  return new Promise((resolve, reject) => {\r\n    // Reset the content of the SVG\r\n    svg.innerHTML = ''; \r\n    svg.setAttribute('data-pdf-annotate-container', true);\r\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\r\n    svg.removeAttribute('data-pdf-annotate-document');\r\n    svg.removeAttribute('data-pdf-annotate-page');\r\n\r\n    // If there's no data nothing can be done\r\n    if (!data) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\r\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\r\n  \r\n    // Make sure annotations is an array\r\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    // Append annotation to svg\r\n    data.annotations.forEach((a) => {\r\n      appendChild(svg, a, viewport);\r\n    });\r\n\r\n    resolve(svg);\r\n  });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/index.js","import objectAssign from 'object-assign';\r\nimport renderLine from './renderLine';\r\nimport renderPath from './renderPath';\r\nimport renderPoint from './renderPoint';\r\nimport renderRect from './renderRect';\r\nimport renderText from './renderText';\r\nimport renderSign from './renderSign';\r\nimport renderSignImg from './renderSignImg';\r\n\r\nconst isFirefox = /firefox/i.test(navigator.userAgent);\r\n\r\n/**\r\n * Get the x/y translation to be used for transforming the annotations\r\n * based on the rotation of the viewport.\r\n *\r\n * @param {Object} viewport The viewport data from the page\r\n * @return {Object}\r\n */\r\nfunction getTranslation(viewport) {\r\n  let x;\r\n  let y;\r\n\r\n  // Modulus 360 on the rotation so that we only\r\n  // have to worry about four possible values.\r\n  switch(viewport.rotation % 360) {\r\n    case 0:\r\n      x = y = 0;\r\n      break;\r\n    case 90:\r\n      x = 0;\r\n      y = (viewport.width / viewport.scale) * -1;\r\n      break;\r\n    case 180:\r\n      x = (viewport.width / viewport.scale) * -1;\r\n      y = (viewport.height / viewport.scale) * -1;\r\n      break;\r\n    case 270:\r\n      x = (viewport.height / viewport.scale) * -1;\r\n      y = 0;\r\n      break;\r\n  }\r\n\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * Transform the rotation and scale of a node using SVG's native transform attribute.\r\n *\r\n * @param {Node} node The node to be transformed\r\n * @param {Object} viewport The page's viewport data\r\n * @return {Node}\r\n */\r\nfunction transform(node, viewport) {\r\n  let trans = getTranslation(viewport);\r\n  let flg = viewport.rotation > 0 ? -1 : 1;\r\n\r\n  // Let SVG natively transform the element\r\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\r\n  \r\n  // Manually adjust x/y for nested SVG nodes\r\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\r\n    if (node.querySelector('path')) {\r\n      node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n      node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n      let x = parseInt(node.getAttribute('x', 10));\r\n      let y = parseInt(node.getAttribute('y', 10));\r\n      let width = parseInt(node.getAttribute('width'), 10);\r\n      let height = parseInt(node.getAttribute('height'), 10);\r\n      let path = node.querySelector('path');\r\n      let svg = path.parentNode;\r\n    \r\n      // Scale width/height\r\n      [node, svg, path, node.querySelector('rect')].forEach((n) => {\r\n        //alert(n.toString());\r\n        n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n        n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n      });\r\n\r\n      // Transform path but keep scale at 100% since it will be handled natively\r\n      transform(path, objectAssign({}, viewport, { scale: 1 }));\r\n      \r\n      switch(viewport.rotation % 360) {\r\n        case 90:\r\n          node.setAttribute('x', viewport.width - y - width);\r\n          node.setAttribute('y', x);\r\n          svg.setAttribute('x', 1);\r\n          svg.setAttribute('y', 0);\r\n          break;\r\n        case 180:\r\n          node.setAttribute('x', viewport.width - x - width);\r\n          node.setAttribute('y', viewport.height - y - height);\r\n          svg.setAttribute('y', 2);\r\n          break;\r\n        case 270:\r\n          node.setAttribute('x', y);\r\n          node.setAttribute('y', viewport.height - x - height);\r\n          svg.setAttribute('x', -1);\r\n          svg.setAttribute('y', 0);\r\n          break;\r\n      }\r\n    } else if (node.querySelector('image')) {\r\n      node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n      node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n      var xsi = parseInt(node.getAttribute('x', 10));\r\n      var ysi = parseInt(node.getAttribute('y', 10));\r\n      var widthsi = parseInt(node.getAttribute('width'), 10);\r\n      var heightsi = parseInt(node.getAttribute('height'), 10);\r\n      var image = node.querySelector('image');\r\n      var xi = parseInt(image.getAttribute('x', 10));\r\n      var yi = parseInt(image.getAttribute('y', 10));\r\n      var widthi = parseInt(image.getAttribute('width'), 10);\r\n      var heighti = parseInt(image.getAttribute('height'), 10);\r\n      //var svgimage = image.parentNode;\r\n      // Scale width/height\r\n      [node, image].forEach(function (n) {\r\n          n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n          n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n      });\r\n\r\n      // Transform image but keep scale at 100% since it will be handled natively\r\n      transform(image, objectAssign({}, viewport, { scale: 1 }));\r\n      \r\n      switch (viewport.rotation % 360) {\r\n          case 90:\r\n              node.setAttribute('x', viewport.width - ysi - heightsi);\r\n              node.setAttribute('y', xsi);\r\n              node.setAttribute('width', heightsi);\r\n              node.setAttribute('height', widthsi);\r\n              image.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + 0 + ', ' + heighti * flg + ')');\r\n              break;\r\n          case 180:\r\n              node.setAttribute('x', viewport.width - xsi - widthsi);\r\n              node.setAttribute('y', viewport.height - ysi - heightsi);\r\n              image.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthi * flg + ', ' + heighti * flg + ')');\r\n              break;\r\n          case 270:\r\n              node.setAttribute('x', ysi);\r\n              node.setAttribute('y', viewport.height - xsi - heightsi);\r\n              node.setAttribute('width', heightsi);\r\n              node.setAttribute('height', widthsi);\r\n              image.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthi * flg + ', ' + 0 + ')');\r\n              break;\r\n      }\r\n    } else if (node.querySelector('text')) {\r\n      node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n      node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n      var text = node.querySelector('text');\r\n      var svgrect = node.querySelector('rect');\r\n      text.setAttribute('x', (parseInt(text.getAttribute('x'), 10) + 40) * viewport.scale - 40);\r\n      text.setAttribute('y', (parseInt(text.getAttribute('y'), 10) - 5) * viewport.scale + 5);\r\n      // Scale width/height\r\n      [node, node.querySelector('rect')].forEach(function (n) {\r\n          n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n          n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n      });\r\n      var xst = parseInt(node.getAttribute('x', 10));\r\n      var yst = parseInt(node.getAttribute('y', 10));\r\n      var widthst = parseInt(node.getAttribute('width'), 10);\r\n      var heightst = parseInt(node.getAttribute('height'), 10);\r\n      //var widtht = parseInt(text.getAttribute('width'), 10);\r\n      //var heightt = parseInt(text.getAttribute('height'), 10);\r\n      var widthr = parseInt(svgrect.getAttribute('width'), 10);\r\n      var heightr = parseInt(svgrect.getAttribute('height'), 10);\r\n\r\n      // Transform text but keep scale at 100% since it will be handled natively      \r\n      transform(text, objectAssign({}, viewport, { scale: 1 }));\r\n\r\n      switch (viewport.rotation % 360) {\r\n          case 90:\r\n              node.setAttribute('x', viewport.width - yst - heightst);\r\n              node.setAttribute('y', xst);\r\n              node.setAttribute('width', heightst);\r\n              node.setAttribute('height', widthst);\r\n              text.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + 0 + ', ' + heightr * flg + ')');\r\n              svgrect.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + 0 + ', ' + heightr * flg + ')');\r\n              //svgrect.setAttribute('y', 0);\r\n              break;\r\n          case 180:\r\n\r\n              node.setAttribute('x', viewport.width - xst - widthst);\r\n              node.setAttribute('y', viewport.height - yst - heightst);\r\n              text.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthr * flg + ', ' + heightr * flg + ')');\r\n              svgrect.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthr * flg + ', ' + heightr * flg + ')');\r\n              break;\r\n          case 270:\r\n              node.setAttribute('x', yst);\r\n              node.setAttribute('y', viewport.height - xst - heightst);\r\n              node.setAttribute('width', heightst);\r\n              node.setAttribute('height', widthst);\r\n              text.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthr * flg + ', ' + 0 + ')');\r\n              svgrect.setAttribute('transform', 'scale(' + viewport.scale + ') rotate(' + viewport.rotation + ') translate(' + widthr * flg + ', ' + 0 + ')');\r\n              break;\r\n      }\r\n    } \r\n  }\r\n\r\n  return node;\r\n}\r\n\r\n/**\r\n * Append an annotation as a child of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element to append the annotation to\r\n * @param {Object} annotation The annotation definition to render and append\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was created and appended by this function\r\n */\r\nexport default function appendChild(svg, annotation, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n  //alert(annotation.type);\r\n  let child;\r\n  switch (annotation.type) {\r\n    case 'area':\r\n    case 'highlight':\r\n      child = renderRect(annotation);\r\n      break;\r\n    case 'strikeout':\r\n      child = renderLine(annotation);\r\n      break;\r\n    case 'point':\r\n      child = renderPoint(annotation);\r\n      break;\r\n    case 'textbox':\r\n      child = renderText(annotation);\r\n      break;\r\n    case 'drawing':\r\n      child = renderPath(annotation);\r\n      break;\r\n    case 'sign':\r\n      child = renderSign(annotation);\r\n      break;\r\n    case 'signimg':\r\n      child = renderSignImg(annotation);\r\n      break;\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip appending/transforming if node doesn't exist.\r\n  if (child) {\r\n    // Set attributes\r\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\r\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\r\n\r\n    switch (annotation.type) {\r\n      case 'point':\r\n        child.setAttribute('data-pdf-annotate-content', annotation.content);\r\n        child.setAttribute('data-pdf-annotate-color', annotation.color);\r\n        //child.setAttribute('data-pdf-annotate-content', annotation.content.replace(/\\\\n/g, '\\r\\n'));\r\n          \r\n        break;\r\n      case 'textbox':\r\n        child.setAttribute('data-pdf-annotate-content', annotation.content);\r\n        break;\r\n      case 'signimg':\r\n        child.setAttribute('data-pdf-annotate-content', annotation.content);\r\n        break;\r\n    }\r\n    \r\n    child.setAttribute('aria-hidden', true);\r\n\r\n    svg.appendChild(transform(child, viewport));\r\n  }\r\n\r\n  return child;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/appendChild.js","/* eslint-disable no-unused-vars */\n'use strict';\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nmodule.exports = Object.assign || function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (Object.getOwnPropertySymbols) {\n\t\t\tsymbols = Object.getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/object-assign/index.js\n// module id = 12\n// module chunks = 0","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGLineElements from an annotation definition.\r\n * This is used for anntations of type `strikeout`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement} A group of all lines to be rendered\r\n */\r\nexport default function renderLine(a) {\r\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  setAttributes(group, {\r\n    stroke: normalizeColor(a.color || '#f00'),\r\n    strokeWidth: 1\r\n  });\r\n\r\n  a.rectangles.forEach((r) => {\r\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n    setAttributes(line, {\r\n      x1: r.x,\r\n      y1: r.y,\r\n      x2: r.x + r.width,\r\n      y2: r.y,\r\n    });\r\n\r\n    group.appendChild(line);\r\n  });\r\n\r\n  return group;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderLine.js","const UPPER_REGEX = /[A-Z]/g;\r\n\r\n// Don't convert these attributes from camelCase to hyphenated-attributes\r\nconst BLACKLIST = [\r\n  'viewBox'\r\n];\r\n\r\nlet keyCase = (key) => {\r\n  if (BLACKLIST.indexOf(key) === -1) {\r\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * Set attributes for a node from a map\r\n *\r\n * @param {Node} node The node to set attributes on\r\n * @param {Object} attributes The map of key/value pairs to use for attributes\r\n */\r\nexport default function setAttributes(node, attributes) {\r\n  Object.keys(attributes).forEach((key) => {\r\n    node.setAttribute(keyCase(key), attributes[key]);\r\n  });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/setAttributes.js","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\r\n\r\n/**\r\n * Normalize a color value\r\n *\r\n * @param {String} color The color to normalize\r\n * @return {String}\r\n */\r\nexport default function normalizeColor(color) {\r\n  if (REGEX_HASHLESS_HEX.test(color)) {\r\n    color = `#${color}`;\r\n  }\r\n  return color;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/normalizeColor.js","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderPath(a) {\r\n  let d = [];\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n  \r\n  for (let i=0, l=a.lines.length; i<l; i++) {\r\n    var p1 = a.lines[i];\r\n    var p2 = a.lines[i+1];\r\n    if (p2) {\r\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n    }\r\n  }\r\n  \r\n  setAttributes(path, {\r\n    d: `${d.join(' ')}Z`,\r\n    stroke: normalizeColor(a.color || '#000'),\r\n    strokeWidth: a.width || 1,\r\n    fill: 'none'\r\n  });\r\n\r\n  return path;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderPath.js","import setAttributes from '../utils/setAttributes';\r\n\r\nconst SIZE = 25;\r\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `comment`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderPoint(a) {\r\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n  setAttributes(outerSVG,  {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: a.x,\r\n    y: a.y\r\n  });\r\n\r\n  setAttributes(innerSVG, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: 0,\r\n    y: (SIZE * 0.05) * -1,\r\n    viewBox: '0 0 1000 1000'\r\n  });\r\n\r\n  setAttributes(rect, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    stroke: '#000',\r\n    fill: '#ff0'\r\n  });\r\n\r\n  setAttributes(path, {\r\n    d: D,\r\n    strokeWidth: 50,\r\n    stroke: '#000',\r\n    fill: '#fff'\r\n  });\r\n\r\n  innerSVG.appendChild(path);\r\n  outerSVG.appendChild(rect);\r\n  outerSVG.appendChild(innerSVG);\r\n\r\n  return outerSVG;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderPoint.js","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGRectElements from an annotation definition.\r\n * This is used for anntations of type `area` and `highlight`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\r\n */\r\nexport default function renderRect(a) {\r\n  if (a.type === 'highlight') {\r\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n    setAttributes(group, {\r\n      fill: normalizeColor(a.color || '#ff0'),\r\n      fillOpacity: 0.2\r\n    });\r\n    \r\n    a.rectangles.forEach((r) => {\r\n      group.appendChild(createRect(r));\r\n    });\r\n\r\n    return group;\r\n  } else {\r\n    let rect = createRect(a);\r\n    setAttributes(rect, {\r\n      stroke: normalizeColor(a.color || '#f00'),\r\n      fill: 'none'\r\n    });\r\n\r\n    return rect;\r\n  }\r\n}\r\n\r\nfunction createRect(r) {\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\r\n  setAttributes(rect, {\r\n    x: r.x,\r\n    y: r.y,\r\n    width: r.width,\r\n    height: r.height\r\n  });\r\n\r\n  return rect;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderRect.js","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGTextElement from an annotation definition.\r\n * This is used for anntations of type `textbox`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGTextElement} A text to be rendered\r\n */\r\nexport default function renderText(a) {\r\n  var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n\r\n  setAttributes(text, {\r\n    x: a.x,\r\n    y: a.y + parseInt(a.size, 10),\r\n    fill: normalizeColor(a.color || '#000'),\r\n    fontSize: a.size\r\n  });\r\n  text.innerHTML = a.content;\r\n\r\n  return text;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderText.js","import setAttributes from '../utils/setAttributes';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `sign`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderSign(a) {\r\n    var outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n    var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n\r\n    setAttributes(outerSVG, {\r\n        width: a.width,\r\n        height: a.height,\r\n        x: a.x,\r\n        y: a.y\r\n    });\r\n    \r\n    setAttributes(rect, {\r\n        width: a.width,\r\n        height: a.height,\r\n        x: 0,\r\n        y: 0,\r\n        stroke: '#f00',\r\n        fill: 'none'\r\n    });\r\n\r\n    setAttributes(text, {\r\n        x: a.width/2-40,\r\n        y: a.height/2+5,\r\n        //width: a.width,\r\n        //height: a.height,\r\n        fill: '#f00',\r\n        fontSize: 10\r\n    });\r\n    text.innerHTML = \"ここに署名を追加\";\r\n\r\n    outerSVG.appendChild(rect);\r\n    outerSVG.appendChild(text);\r\n    //return rect;\r\n    return outerSVG;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderSign.js","import setAttributes from '../utils/setAttributes';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `signimg`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderSignImg(a) {\r\n    var outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    var img = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n    \r\n    setAttributes(outerSVG, {\r\n        width: a.width,\r\n        height: a.height,\r\n        x: a.x,\r\n        y: a.y\r\n    });\r\n    setAttributes(img, {\r\n        width: a.width,\r\n        height: a.height,\r\n        x: 0,\r\n        y: 0,\r\n        href: a.content\r\n        });\r\n\r\n    outerSVG.appendChild(img);\r\n    return outerSVG;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/render/renderSignImg.js","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport initEventHandlers from './initEventHandlers';\r\n\r\n// TODO This is not the right place for this to live\r\ninitEventHandlers();\r\n\r\n/**\r\n * Insert hints into the DOM for screen readers.\r\n *\r\n * @param {Array} annotations The annotations that hints are inserted for\r\n */\r\nexport default function renderScreenReaderHints(annotations) {\r\n  annotations = Array.isArray(annotations) ? annotations : [];\r\n\r\n  // Insert hints for each type\r\n  Object.keys(SORT_TYPES).forEach((type) => {\r\n    let sortBy = SORT_TYPES[type];\r\n    annotations\r\n      .filter((a) => a.type === type)\r\n      .sort(sortBy)\r\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\r\n  });\r\n}\r\n\r\n// Sort annotations first by y, then by x.\r\n// This allows hints to be injected in the order they appear,\r\n// which makes numbering them easier.\r\nfunction sortByPoint(a, b) {\r\n  if (a.y < b.y) {\r\n    return a.x - b.x;\r\n  } else {\r\n    return 1;\r\n  }\r\n}\r\n\r\n// Sort annotation by it's first rectangle\r\nfunction sortByRectPoint(a, b) {\r\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\r\n}\r\n\r\n// Sort annotation by it's first line\r\nfunction sortByLinePoint(a, b) {\r\n  let lineA = a.lines[0];\r\n  let lineB = b.lines[0];\r\n  return sortByPoint(\r\n    {x: lineA[0], y: lineA[1]},\r\n    {x: lineB[0], y: lineB[1]}\r\n  );\r\n}\r\n\r\n// Arrange supported types and associated sort methods\r\nconst SORT_TYPES = {\r\n  'highlight': sortByRectPoint,\r\n  'strikeout': sortByRectPoint,\r\n  'drawing': sortByLinePoint,\r\n  'textbox': sortByPoint,\r\n  'point': sortByPoint,\r\n  'area': sortByPoint,\r\n  'sign': sortByPoint,\r\n  'signimg': sortByPoint\r\n};\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/renderScreenReaderHints.js","import createScreenReaderOnly from './createScreenReaderOnly';\r\nimport insertElementWithinChildren from './insertElementWithinChildren';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\n\r\n// Annotation types that support comments\r\nconst COMMENT_TYPES = ['highlight', 'point', 'area'];\r\n\r\n/**\r\n * Insert a hint into the DOM for screen readers for a specific annotation.\r\n *\r\n * @param {Object} annotation The annotation to insert a hint for\r\n * @param {Number} num The number of the annotation out of all annotations of the same type\r\n */\r\nexport default function insertScreenReaderHint(annotation, num = 0) {\r\n  switch (annotation.type) {\r\n    case 'highlight':\r\n    case 'strikeout':\r\n      let rects = annotation.rectangles;\r\n      let first = rects[0];\r\n      let last = rects[rects.length - 1];\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\r\n        first.x, first.y, annotation.page, true\r\n      );\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\r\n        last.x + last.width, last.y, annotation.page, false\r\n      );\r\n      break;\r\n\r\n    case 'textbox':\r\n    case 'point':\r\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\r\n        annotation.x, annotation.y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'drawing':\r\n    case 'area':\r\n    case 'sign':\r\n    case 'signimg':      \r\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\r\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x, y, annotation.page\r\n      );\r\n      break;\r\n  }\r\n\r\n  // Include comments in screen reader hint\r\n  if (COMMENT_TYPES.includes(annotation.type)) {\r\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/insertScreenReaderHint.js","/**\r\n * Create a node that is only visible to screen readers\r\n *\r\n * @param {String} content The text content that should be read by screen reader\r\n * @param {String} [annotationId] The ID of the annotation assocaited\r\n * @return {Element} An Element that is only visible to screen readers\r\n */\r\nexport default function createScreenReaderOnly(content, annotationId) {\r\n  let node = document.createElement('div');\r\n  let text = document.createTextNode(content);\r\n  node.appendChild(text);\r\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\r\n  node.style.position = 'absolute';\r\n  node.style.left = '-10000px';\r\n  node.style.top = 'auto';\r\n  node.style.width = '1px';\r\n  node.style.height = '1px';\r\n  node.style.overflow = 'hidden';\r\n  return node;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/createScreenReaderOnly.js","import insertElementWithinElement from './insertElementWithinElement';\r\nimport { pointIntersectsRect } from '../UI/utils';\r\nimport { scaleUp } from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will try to insert between elements if possible.\r\n * It will however use `insertElementWithinElement` if it is more accurate.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\r\n  // Try and use most accurate method of inserting within an element\r\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\r\n    return true;\r\n  }\r\n\r\n  // Fall back to inserting between elements\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  let nodes = [...svg.parentNode.querySelectorAll('.textLayer > div')];\r\n\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n\r\n  // Find the best node to insert before\r\n  for (let i=0, l=nodes.length; i<l; i++) {\r\n    let n = nodes[i];\r\n    let r = n.getBoundingClientRect();\r\n    if (y <= r.top) {\r\n      n.parentNode.insertBefore(el, n);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // If all else fails try to append to the bottom\r\n  let textLayer = svg.parentNode.querySelector('.textLayer');\r\n  if (textLayer) {\r\n    let textRect = textLayer.getBoundingClientRect();\r\n    if (pointIntersectsRect(x, y, textRect)) {\r\n      textLayer.appendChild(el);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/insertElementWithinChildren.js","import {\r\n  pointIntersectsRect,\r\n  scaleUp,\r\n  scaleDown\r\n} from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will only insert within an element amidst it's text content.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\r\n  const OFFSET_ADJUST = 2;\r\n\r\n  // If inserting before adjust `x` by looking for element a few px to the right\r\n  // Otherwise adjust a few px to the left\r\n  // This is to allow a little tolerance by searching within the box, instead\r\n  // of getting a false negative by testing right on the border.\r\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\r\n\r\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\r\n  if (!node) {\r\n    return false;\r\n  }\r\n  \r\n  // Now that node has been found inverse the adjustment for `x`.\r\n  // This is done to accomodate tolerance by cutting off on the outside of the\r\n  // text boundary, instead of missing a character by cutting off within.\r\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\r\n\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\r\n  let temp = node.cloneNode(true);\r\n  let head = temp.innerHTML.split('');\r\n  let tail = [];\r\n\r\n  // Insert temp off screen\r\n  temp.style.position = 'absolute';\r\n  temp.style.top = '-10000px';\r\n  temp.style.left = '-10000px';\r\n  document.body.appendChild(temp);\r\n\r\n  while (head.length) {\r\n    // Don't insert within HTML tags\r\n    if (head[head.length - 1] === '>') {\r\n      while(head.length) {\r\n        tail.unshift(head.pop());\r\n        if (tail[0] === '<') {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Check if width of temp based on current head value satisfies x\r\n    temp.innerHTML = head.join('');\r\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\r\n    if (left + width <= x) {\r\n      break;\r\n    }\r\n    tail.unshift(head.pop());\r\n  }\r\n  \r\n  // Update original node with new markup, including element to be inserted\r\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\r\n  temp.parentNode.removeChild(temp);\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Get a text layer element at a given point on a page\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page to limit elements to\r\n * @return {Element} First text layer element found at the point\r\n */\r\nfunction textLayerElementFromPoint(x, y, pageNumber) {\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n  return [...svg.parentNode.querySelectorAll('.textLayer [data-canvas-width]')].filter((el) => {\r\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\r\n  })[0];\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/insertElementWithinElement.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\n\r\n/**\r\n * Insert the comments into the DOM to be available by screen reader\r\n *\r\n * Example output:\r\n *   <div class=\"screenReaderOnly\">\r\n *    <div>Begin highlight 1</div>\r\n *    <ol aria-label=\"Comments\">\r\n *      <li>Foo</li>\r\n *      <li>Bar</li>\r\n *      <li>Baz</li>\r\n *      <li>Qux</li>\r\n *    </ol>\r\n *  </div>\r\n *  <div>Some highlighted text goes here...</div>\r\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\r\n *\r\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of the annotation\r\n * @param {Array} [comments] Optionally preloaded comments to be rendered\r\n * @return {Promise}\r\n */\r\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\r\n  let promise;\r\n\r\n  if (Array.isArray(comments)) {\r\n    promise = Promise.resolve(comments);\r\n  } else {\r\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\r\n  }\r\n\r\n  return promise.then((comments) => {\r\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\r\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\r\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n    if (node) { \r\n      let list = document.createElement('ol');\r\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      list.setAttribute('aria-label', 'Comments');\r\n      node.appendChild(list);\r\n      comments.forEach(insertScreenReaderComment);\r\n    }\r\n  });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/renderScreenReaderComments.js","/**\r\n * Insert a comment into the DOM to be available by screen reader\r\n *\r\n * @param {Object} comment The comment to be inserted\r\n */\r\nexport default function insertScreenReaderComment(comment) {\r\n  if (!comment) {\r\n    return;\r\n  }\r\n\r\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\r\n  if (list) {\r\n    let item = document.createElement('li');\r\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\r\n    item.appendChild(document.createTextNode(`${comment.content}`));\r\n    list.appendChild(item);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/insertScreenReaderComment.js","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport renderScreenReaderHints from './renderScreenReaderHints';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\nimport { addEventListener } from '../UI/event';\r\nimport PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\n/**\r\n * Initialize the event handlers for keeping screen reader hints synced with data\r\n */\r\nexport default function initEventHandlers() {\r\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\r\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\r\n  });\r\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\r\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\r\n  });\r\n  addEventListener('annotation:delete', removeAnnotation);\r\n  addEventListener('comment:add', insertComment);\r\n  addEventListener('comment:delete', removeComment);\r\n}\r\n\r\n/**\r\n * Reorder the annotation numbers by annotation type\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {Number} pageNumber The page number of the annotations\r\n * @param {Strig} type The annotation type\r\n */\r\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\r\n    .then((annotations) => {\r\n      return annotations.annotations.filter((a) => {\r\n        return a.type === type;\r\n      });\r\n    })\r\n    .then((annotations) => {\r\n      annotations.forEach((a) => {\r\n        removeAnnotation(documentId, a.uuid);\r\n      });\r\n\r\n      return annotations;\r\n    })\r\n    .then(renderScreenReaderHints);\r\n}\r\n\r\n/**\r\n * Remove the screen reader hint for an annotation\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The Id of the annotation\r\n */\r\nfunction removeAnnotation(documentId, annotationId) {\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\r\n}\r\n\r\n/**\r\n * Insert a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of tha assocated annotation\r\n * @param {Object} comment The comment to insert a hint for\r\n */\r\nfunction insertComment(documentId, annotationId, comment) {\r\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n  let promise;\r\n\r\n  if (!list) {\r\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\r\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      return true;\r\n    });\r\n  } else {\r\n    promise = Promise.resolve(true);\r\n  }\r\n\r\n  promise.then(() => {\r\n    insertScreenReaderComment(comment);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} commentId The ID of the comment\r\n */\r\nfunction removeComment(documentId, commentId) {\r\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\r\n}\r\n\r\n/**\r\n * Remove an element from the DOM by it's ID if it exists\r\n *\r\n * @param {String} elementID The ID of the element to be removed\r\n */\r\nfunction removeElementById(elementId) {\r\n  let el = document.getElementById(elementId);\r\n  if (el) {\r\n    el.parentNode.removeChild(el);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/a11y/initEventHandlers.js","import { addEventListener, removeEventListener, fireEvent } from './event';\r\nimport { disableEdit, enableEdit } from './edit';\r\nimport { disablePen, enablePen, setPen } from './pen';\r\nimport { disablePoint, enablePoint, setPoint } from './point';\r\nimport { disableRect, enableRect } from './rect';\r\nimport { disableText, enableText, setText } from './text';\r\nimport { createPage, renderPage } from './page';\r\nimport { disableSignature, enableSignature } from './signature';\r\nimport { disableSignimg, enableSignimg } from './signimg';\r\n\r\nexport default {\r\n  addEventListener, removeEventListener, fireEvent,\r\n  disableEdit, enableEdit,\r\n  disablePen, enablePen, setPen,\r\n  disablePoint, enablePoint, setPoint,\r\n  disableRect, enableRect,\r\n  disableText, enableText, setText,\r\n  disableSignature, enableSignature,\r\n  disableSignimg, enableSignimg,\r\n  createPage, renderPage  \r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/index.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  addEventListener,\r\n  removeEventListener\r\n} from './event';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGContainer,\r\n  findSVGAtPoint,\r\n  getAnnotationRect,\r\n  getMetadata,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet isDragging = false, overlay;\r\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\r\nconst OVERLAY_BORDER_SIZE = 3;\r\n\r\n/**\r\n * Create an overlay for editing an annotation.\r\n *\r\n * @param {Element} target The annotation element to apply overlay for\r\n */\r\nfunction createEditOverlay(target) {\r\n  destroyEditOverlay();\r\n\r\n  overlay = document.createElement('div');\r\n  let anchor = document.createElement('a');\r\n  let parentNode = findSVGContainer(target).parentNode;\r\n  let id = target.getAttribute('data-pdf-annotate-id');\r\n  \r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n  let content = target.getAttribute('data-pdf-annotate-content');\r\n  let color = target.getAttribute('data-pdf-annotate-color');  \r\n  let rect = getAnnotationRect(target);\r\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\r\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\r\n  \r\n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\r\n  overlay.setAttribute('data-target-id', id);\r\n  overlay.setAttribute('data-pdf-annotate-type', type);\r\n  overlay.style.boxSizing = 'content-box';\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${styleTop}px`;\r\n  overlay.style.left = `${styleLeft}px`;\r\n\r\n  if ('textbox' === type) {\r\n    overlay.style.background = '#fff';\r\n    overlay.style.width = rect.width>134 ?  rect.width + 'px' : '134px';\r\n    overlay.style.height = rect.height > 20 ? rect.height + 'px' : '20px';\r\n  } else {\r\n    overlay.style.width = `${rect.width}px`;\r\n    overlay.style.height = `${rect.height}px`;\r\n  }\r\n  \r\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\r\n\r\n  overlay.setAttribute('data-pdf-annotate-content', content);\r\n  overlay.setAttribute('data-pdf-annotate-color', color);\r\n\r\n  anchor.innerHTML = '×';\r\n  anchor.setAttribute('href', 'javascript://');\r\n  anchor.style.background = '#fff';\r\n  anchor.style.borderRadius = '20px';\r\n  anchor.style.border = '1px solid #bbb';\r\n  anchor.style.color = '#bbb';\r\n  anchor.style.fontSize = '16px';\r\n  anchor.style.padding = '2px';\r\n  anchor.style.textAlign = 'center';\r\n  anchor.style.textDecoration = 'none';\r\n  anchor.style.position = 'absolute';\r\n  anchor.style.top = '-13px';\r\n  anchor.style.right = '-13px';\r\n  anchor.style.width = '25px';\r\n  anchor.style.height = '25px';\r\n  \r\n  overlay.appendChild(anchor);\r\n\r\n  if ('point' === type) {\r\n    //var spandiv = document.createElement('div');\r\n    //spandiv.innerHTML = content;\r\n    let spantextarea = document.createElement('textarea');\r\n    spantextarea.setAttribute('id', id + 'textarea');\r\n    spantextarea.value = content;\r\n    spantextarea.style.position = 'absolute';\r\n    spantextarea.style.top = rect.height + 'px';\r\n    spantextarea.style.left = (rect.width - 13) + 'px';\r\n    spantextarea.style.background = color;\r\n    spantextarea.style.width = '275px';\r\n    spantextarea.rows = 5;\r\n    overlay.appendChild(spantextarea);\r\n\r\n    spantextarea.addEventListener('onfocus', inputDocumentClick);\r\n    spantextarea.addEventListener('change', editAnnotation);\r\n    spantextarea.addEventListener('click', inputDocumentClick);\r\n    /*\r\n    spandiv.style.border = '1px solid #bbb';\r\n    spandiv.style.color = '#000000';\r\n    spandiv.style.fontSize = '16px';\r\n    spandiv.style.padding = '2px';\r\n    spandiv.style.textAlign = 'left';\r\n    spandiv.style.textDecoration = 'none';\r\n    spandiv.style.position = 'absolute';\r\n    spandiv.style.top =rect.height + 'px';\r\n    spandiv.style.left = (rect.width -13) + 'px';\r\n    \r\n    overlay.appendChild(spandiv);\r\n    //20210209\r\n    spandiv.addEventListener('click', inputDocumentClick);*/\r\n  }\r\n  else if ('textbox' === type) {\r\n    let spaninput = document.createElement('input');\r\n    spaninput.setAttribute('id', id + 'input');\r\n    spaninput.type = 'text';\r\n    spaninput.style.textAlign = 'left';\r\n    spaninput.style.height = rect.height + 'px';\r\n    spaninput.value = content;\r\n\r\n\r\n    spaninput.style.border = '0px solid ';\r\n\r\n    let textSize = target.getAttribute('font-size');\r\n    spaninput.style.fontSize = textSize + 'px';\r\n    spaninput.style.width = rect.width > 128 ? rect.width + 'px' : '128px';\r\n\r\n    overlay.appendChild(spaninput);\r\n    spaninput.addEventListener('onfocus', inputDocumentClick);\r\n    spaninput.addEventListener('click', inputDocumentClick);\r\n    spaninput.addEventListener('change', editAnnotation);\r\n\r\n  } else if ('sign' === type) {\r\n    overlay.addEventListener('click', inputDocumentClickS);\r\n  }\r\n\r\n  parentNode.appendChild(overlay);\r\n  document.addEventListener('click', handleDocumentClick);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  anchor.addEventListener('click', deleteAnnotation);\r\n  anchor.addEventListener('mouseover', () => {\r\n    anchor.style.color = '#35A4DC';\r\n    anchor.style.borderColor = '#999';\r\n    anchor.style.boxShadow = '0 1px 1px #ccc';\r\n  });\r\n  anchor.addEventListener('mouseout', () => {\r\n    anchor.style.color = '#bbb';\r\n    anchor.style.borderColor = '#bbb';\r\n    anchor.style.boxShadow = '';\r\n  });\r\n  overlay.addEventListener('mouseover', () => {\r\n    if (!isDragging) { anchor.style.display = ''; }\r\n  });\r\n  overlay.addEventListener('mouseout', () => {\r\n    anchor.style.display = 'none';\r\n  });\r\n}\r\n\r\n/**\r\n * Destroy the edit overlay if it exists.\r\n */\r\nfunction destroyEditOverlay() {\r\n  if (overlay) {\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n  }\r\n\r\n  document.removeEventListener('click', handleDocumentClick);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Delete currently selected annotation\r\n */\r\nfunction deleteAnnotation() {\r\n  if (!overlay) { return; }\r\n\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n \r\n  let _getMetadata = getMetadata(svg);\r\n  let documentId = _getMetadata.documentId;\r\n\r\n  [...nodes].forEach((n) => {\r\n    n.parentNode.removeChild(n);\r\n  });\r\n  \r\n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\r\n\r\n  destroyEditOverlay();\r\n  e.stopPropagation();\r\n}\r\n\r\n/** 20210209\r\n* edit annotation\r\n*/\r\nfunction editAnnotation() {\r\n  if (!overlay) {\r\n      return;\r\n  }\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let type = overlay.getAttribute('data-pdf-annotate-type');\r\n  let nodes = document.querySelectorAll('[data-pdf-annotate-id=\"' + annotationId + '\"]');\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let val;\r\n  if ('textbox' === type) {\r\n      val = document.getElementById(annotationId + 'input').value;\r\n  } else {\r\n      val = document.getElementById(annotationId + 'textarea').value;\r\n  }\r\n\r\n  let _getMetadata = getMetadata(svg);\r\n  let documentId = _getMetadata.documentId;\r\n\r\n  [...nodes].forEach((n) => {\r\n      n.setAttribute('data-pdf-annotate-content', val);\r\n      if ('textbox' === type) {\r\n          n.innerHTML = val;\r\n      }\r\n  });\r\n\r\n  let promise = PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId);\r\n  promise.then((annotation) => {\r\n      annotation.content = val;\r\n      PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\r\n  });\r\n  \r\n  destroyEditOverlay();\r\n}\r\n\r\nfunction inputDocumentClick(e) {\r\n  e.stopPropagation();\r\n}\r\n\r\nfunction inputDocumentClickS(e) {\r\n  $(\"#signdialogbutton\").attr(\"sign-id\", overlay.getAttribute('data-target-id'));\r\n  document.getElementById(\"signdialogbutton\").click();\r\n  e.stopPropagation();\r\n}\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  // Remove current overlay\r\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\r\n  if (overlay) {\r\n    if (isDragging || e.target === overlay) {\r\n      return;\r\n    }\r\n\r\n    destroyEditOverlay();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  if (overlay && e.keyCode === 46 &&\r\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\r\n      e.target.nodeName.toLowerCase() !== 'input') {\r\n    deleteAnnotation();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  if (e.target !== overlay) { return; }\r\n\r\n  // Highlight and strikeout annotations are bound to text within the document.\r\n  // It doesn't make sense to allow repositioning these types of annotations.\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n\r\n  if (type === 'highlight' || type === 'strikeout') { return; }\r\n\r\n  isDragging = true;\r\n  dragOffsetX = e.clientX;\r\n  dragOffsetY = e.clientY;\r\n  dragStartX = overlay.offsetLeft;\r\n  dragStartY = overlay.offsetTop;\r\n  \r\n  if ('textbox' !== type) {\r\n    overlay.style.background = 'rgba(255, 255, 255, 0.7)';\r\n  }\r\n\r\n  overlay.style.cursor = 'move';\r\n  overlay.querySelector('a').style.display = 'none';\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let parentNode = overlay.parentNode;\r\n  let rect = parentNode.getBoundingClientRect();\r\n  let y = (dragStartY + (e.clientY - dragOffsetY));\r\n  let x = (dragStartX + (e.clientX - dragOffsetX));\r\n  let minY = 0;\r\n  let maxY = rect.height;\r\n  let minX = 0;\r\n  let maxX = rect.width;\r\n\r\n  if (y > minY && y + overlay.offsetHeight < maxY) {\r\n    overlay.style.top = `${y}px`;\r\n  }\r\n\r\n  if (x > minX && x + overlay.offsetWidth < maxX) {\r\n    overlay.style.left = `${x}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target[0].getAttribute('data-pdf-annotate-type');\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let { documentId } = getMetadata(svg);\r\n  \r\n  overlay.querySelector('a').style.display = '';\r\n\r\n  function getDelta(propX, propY) {\r\n    return calcDelta(parseInt(target[0].getAttribute(propX), 10), parseInt(target[0].getAttribute(propY), 10));\r\n  }\r\n\r\n  function calcDelta(x, y) {\r\n    return {\r\n      deltaX: OVERLAY_BORDER_SIZE + scaleDown(svg, {x: overlay.offsetLeft}).x - x,\r\n      deltaY: OVERLAY_BORDER_SIZE + scaleDown(svg, {y: overlay.offsetTop}).y - y\r\n    };\r\n  }\r\n\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\r\n    if (['area', 'highlight', 'point', 'textbox', 'sign', 'signimg'].indexOf(type) > -1) {\r\n      let { deltaX, deltaY } = getDelta('x', 'y');\r\n      [...target].forEach((t, i) => {\r\n        if (deltaY !== 0) {\r\n          let modelY = parseInt(t.getAttribute('y'), 10) + deltaY;\r\n          let viewY = modelY;\r\n\r\n          if (type === 'textbox') {\r\n            viewY += annotation.size;\r\n          }\r\n\r\n          if (type === 'point' || type === 'sign' || type === 'signimg') {\r\n            viewY = scaleUp(svg, { viewY }).viewY;\r\n          }\r\n\r\n          t.setAttribute('y', viewY);\r\n          if (annotation.rectangles) {\r\n            annotation.rectangles[i].y = modelY;\r\n          } else if (annotation.y) {\r\n            annotation.y = modelY;\r\n          }\r\n        }\r\n        if (deltaX !== 0) {\r\n          let modelX = parseInt(t.getAttribute('x'), 10) + deltaX;\r\n          let viewX = modelX;\r\n\r\n          if (type === 'point' || type === 'sign' || type === 'signimg') {\r\n            viewX = scaleUp(svg, { viewX }).viewX;\r\n          }\r\n\r\n          t.setAttribute('x', viewX);\r\n          if (annotation.rectangles) {\r\n            annotation.rectangles[i].x = modelX;\r\n          } else if (annotation.x) {\r\n            annotation.x = modelX;\r\n          }\r\n        }\r\n      });\r\n    // } else if (type === 'strikeout') {\r\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\r\n    //   [...target].forEach(target, (t, i) => {\r\n    //     if (deltaY !== 0) {\r\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\r\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\r\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\r\n    //     }\r\n    //     if (deltaX !== 0) {\r\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\r\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\r\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\r\n    //     }\r\n    //   });\r\n    } else if (type === 'drawing') {\r\n      let rect = scaleDown(svg, getAnnotationRect(target[0]));\r\n      let [originX, originY] = annotation.lines[0];\r\n      let { deltaX, deltaY } = calcDelta(originX, originY);\r\n\r\n      // origin isn't necessarily at 0/0 in relation to overlay x/y\r\n      // adjust the difference between overlay and drawing coords\r\n      deltaY += (originY - rect.top);\r\n      deltaX += (originX - rect.left);\r\n\r\n      annotation.lines.forEach((line, i) => {\r\n        let [x, y] = annotation.lines[i];\r\n        annotation.lines[i][0] = x + deltaX;\r\n        annotation.lines[i][1] = y + deltaY;\r\n      });\r\n\r\n      target[0].parentNode.removeChild(target[0]);\r\n      appendChild(svg, annotation);\r\n    }\r\n\r\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\r\n  });\r\n\r\n  setTimeout(() => {\r\n    isDragging = false;\r\n  }, 0);\r\n\r\n  if ('textbox' !== type) {\r\n    overlay.style.background = '';\r\n  }\r\n  overlay.style.cursor = '';\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle annotation.click event\r\n *\r\n * @param {Element} e The annotation element that was clicked\r\n */\r\nfunction handleAnnotationClick(target) {\r\n  createEditOverlay(target);\r\n}\r\n\r\n/**\r\n * Enable edit mode behavior.\r\n */\r\nexport function enableEdit () {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  addEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n/**\r\n * Disable edit mode behavior.\r\n */\r\nexport function disableEdit () {\r\n  destroyEditOverlay();\r\n\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  removeEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/edit.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines;\r\n\r\n/**\r\n * Handle document.mousedown event\r\n */\r\nfunction handleDocumentMousedown() {\r\n  path = null;\r\n  lines = [];\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\r\n        type: 'drawing',\r\n        width: _penSize,\r\n        color: _penColor,\r\n        lines\r\n      }\r\n    ).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  savePoint(e.clientX, e.clientY);\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = scaleDown(svg, {\r\n    x: x - rect.left,\r\n    y: y - rect.top\r\n  });\r\n\r\n  lines.push([point.x, point.y]);\r\n\r\n  if (lines.length <= 1) {\r\n    return;\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'drawing',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setPen(penSize = 1, penColor = '000000') {\r\n  _penSize = parseInt(penSize, 10);\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enablePen() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disablePen() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/pen.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _pointColor = '#fff9c7';\r\nlet input;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return\r\n  }\r\n  \r\n  /*\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-point-input');\r\n  input.setAttribute('placeholder', 'Enter comment');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n  */\r\n\r\n  //20210209\r\n  input = document.createElement('textarea');\r\n  input.setAttribute('id', 'pdf-annotate-point-input');\r\n  input.setAttribute('placeholder', '付箋を入力してください');  \r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = e.clientY + 'px';\r\n  input.style.left = e.clientX + 'px';\r\n  input.style.zIndex = '9999';\r\n  input.style.background = _pointColor;\r\n  input.style.width = '275px';\r\n  input.rows = 5;\r\n\r\n  if ($(\"#ShowUserNameInComment\").val() === \"1\") {\r\n    input.value = $(\"#UserName\").val() + \": \\r\\n\";\r\n  }\r\n\r\n  input.addEventListener('blur', handleInputBlur);\r\n  //20210209\r\n  //input.addEventListener('keyup', handleInputKeyup);\r\n\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  savePoint();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    savePoint();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a new point annotation from input\r\n */\r\nfunction savePoint() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let content = input.value.trim();\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let rect = svg.getBoundingClientRect();\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    let annotation = Object.assign({\r\n        type: 'point',\r\n        content: content,\r\n        color: _pointColor\r\n      }, scaleDown(svg, {\r\n        x: clientX - rect.left,\r\n        y: clientY - rect.top\r\n      })\r\n    );\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        PDFJSAnnotate.getStoreAdapter().addComment(\r\n          documentId,\r\n          annotation.uuid,\r\n          content\r\n        );\r\n\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input element\r\n */\r\nfunction closeInput() {\r\n  input.removeEventListener('blur', handleInputBlur);\r\n  input.removeEventListener('keyup', handleInputKeyup);\r\n  document.body.removeChild(input);\r\n  input = null;\r\n}\r\n\r\n\t/**\r\n\t * Set the attributes of the point.\r\n\t *\t \r\n\t * @param {String} pointColor the background color \r\n\t */\r\n   export function setPoint() {\r\n\t\t_pointColor = arguments.length <= 0 || arguments[0] === undefined ? '#fff9c7' : arguments[0];\r\n\t}\r\n\t\r\n\r\n/**\r\n * Enable point annotation behavior\r\n */\r\nexport function enablePoint() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable point annotation behavior\r\n */\r\nexport function disablePoint() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/point.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  getOffset,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n  try {\r\n    let selection = window.getSelection();\r\n    let range = selection.getRangeAt(0);\r\n    let rects = range.getClientRects();\r\n\r\n    if (rects.length > 0 &&\r\n        rects[0].width > 0 &&\r\n        rects[0].height > 0) {\r\n      return rects;\r\n    }\r\n  } catch (e) {}\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let svg;\r\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  originY = e.clientY;\r\n  originX = e.clientX;\r\n\r\n  overlay = document.createElement('div');\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${originY - rect.top}px`;\r\n  overlay.style.left = `${originX - rect.left}px`;\r\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = '3px';\r\n  svg.parentNode.appendChild(overlay);\r\n  \r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let rect = svg.getBoundingClientRect();\r\n\r\n  if (originX + (e.clientX - originX) < rect.right) {\r\n    overlay.style.width = `${e.clientX - originX}px`;\r\n  }\r\n\r\n  if (originY + (e.clientY - originY) < rect.bottom) {\r\n    overlay.style.height = `${e.clientY - originY}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let rects;\r\n  if (_type !== 'area' && (rects = getSelectionRects())) {\r\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n    saveRect(_type, [...rects].map((r) => {\r\n      return {\r\n        top: r.top,\r\n        left: r.left,\r\n        width: r.width,\r\n        height: r.height\r\n      };\r\n    }));\r\n  } else if (_type === 'area' && overlay) {\r\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n    let rect = svg.getBoundingClientRect();\r\n    saveRect(_type, [{\r\n      top: parseInt(overlay.style.top, 10) + rect.top,\r\n      left: parseInt(overlay.style.left, 10) + rect.left,\r\n      width: parseInt(overlay.style.width, 10),\r\n      height: parseInt(overlay.style.height, 10)\r\n    }]);\r\n\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    enableUserSelect();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    let selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    if (overlay && overlay.parentNode) {\r\n      overlay.parentNode.removeChild(overlay);\r\n      overlay = null;\r\n      document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Save a rect annotation\r\n *\r\n * @param {String} type The type of rect (area, highlight, strikeout)\r\n * @param {Array} rects The rects to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveRect(type, rects, color) {\r\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n  let node;\r\n  let annotation;\r\n\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let boundingRect = svg.getBoundingClientRect();\r\n\r\n  if (!color) {\r\n    if (type === 'highlight') {\r\n      color = 'FFFF00';\r\n    } else if (type === 'strikeout') {\r\n      color = 'FF0000';\r\n    }\r\n  }\r\n\r\n  // Initialize the annotation\r\n  annotation = {\r\n    type,\r\n    color,\r\n    rectangles: [...rects].map((r) => {\r\n      let offset = 0;\r\n\r\n      if (type === 'strikeout') {\r\n        offset = r.height / 2;\r\n      }\r\n\r\n      return scaleDown(svg, {\r\n        y: (r.top + offset) - boundingRect.top,\r\n        x: r.left - boundingRect.left,\r\n        width: r.width,\r\n        height: r.height\r\n      });\r\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\r\n  };\r\n  \r\n  // Short circuit if no rectangles exist\r\n  if (annotation.rectangles.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // Special treatment for area as it only supports a single rect\r\n  if (type === 'area') {\r\n    let rect = annotation.rectangles[0];\r\n    delete annotation.rectangles;\r\n    annotation.x = rect.x;\r\n    annotation.y = rect.y;\r\n    annotation.width = rect.width;\r\n    annotation.height = rect.height;\r\n  }\r\n\r\n  let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable rect behavior\r\n */\r\nexport function enableRect(type) {\r\n  _type = type;\r\n  \r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n * Disable rect behavior\r\n */\r\nexport function disableRect() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/rect.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\nlet _textSize;\r\nlet _textColor;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-text-input');\r\n  input.setAttribute('placeholder', 'テキストを入力してください');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n  input.style.fontSize = `${_textSize}px`;\r\n  input.style.zIndex = '9999';\r\n \r\n  input.addEventListener('blur', handleInputBlur);  \r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  saveText();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    saveText();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a text annotation from input\r\n */\r\nfunction saveText() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    let rect = svg.getBoundingClientRect();\r\n    let annotation = Object.assign({\r\n        type: 'textbox',\r\n        size: _textSize,\r\n        color: _textColor,\r\n        content: input.value.trim()\r\n      }, scaleDown(svg, {\r\n        x: clientX - rect.left,\r\n        y: clientY -  rect.top,\r\n        width: input.offsetWidth,\r\n        height: input.offsetHeight\r\n      })\r\n    );\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n  \r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input\r\n */\r\nfunction closeInput() {\r\n  if (input) {\r\n    input.removeEventListener('blur', handleInputBlur);\r\n    input.removeEventListener('keyup', handleInputKeyup);\r\n    document.body.removeChild(input);\r\n    input = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set the text attributes\r\n *\r\n * @param {Number} textSize The size of the text\r\n * @param {String} textColor The color of the text\r\n */\r\nexport function setText(textSize = 12, textColor = '000000') {\r\n  _textSize = parseInt(textSize, 10);\r\n  _textColor = textColor;\r\n}\r\n\r\n\r\n/**\r\n * Enable text behavior\r\n */\r\nexport function enableText() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\r\n/**\r\n * Disable text behavior\r\n */\r\nexport function disableText() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/text.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n// Template for creating a new page\r\nconst PAGE_TEMPLATE = `\r\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\r\n    <div class=\"canvasWrapper\">\r\n      <canvas></canvas>\r\n    </div>\r\n    <svg class=\"annotationLayer\"></svg>\r\n    <div class=\"textLayer\"></div>\r\n  </div>\r\n`;\r\n\r\n/**\r\n * Create a new page to be appended to the DOM.\r\n *\r\n * @param {Number} pageNumber The page number that is being created\r\n * @return {HTMLElement}\r\n */\r\nexport function createPage(pageNumber) {\r\n  let temp = document.createElement('div');\r\n  temp.innerHTML = PAGE_TEMPLATE;\r\n\r\n  let page = temp.children[0];\r\n  let canvas = page.querySelector('canvas');\r\n\r\n  page.setAttribute('id', `pageContainer${pageNumber}`);\r\n  page.setAttribute('data-page-number', pageNumber);\r\n\r\n  canvas.mozOpaque = true;\r\n  canvas.setAttribute('id', `page${pageNumber}`);\r\n\r\n  return page;\r\n}\r\n\r\n/**\r\n * Render a page that has already been created.\r\n *\r\n * @param {Number} pageNumber The page number to be rendered\r\n * @param {Object} renderOptions The options for rendering\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: [pdfPage, annotations]\r\n *    - rejected: Error\r\n */\r\nexport function renderPage(pageNumber, renderOptions) {\r\n  let {\r\n    documentId,\r\n    pdfDocument,\r\n    scale,\r\n    rotate\r\n  } = renderOptions;\r\n\r\n  // Load the page and annotations\r\n  return Promise.all([\r\n    pdfDocument.getPage(pageNumber),\r\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\r\n  ]).then(([pdfPage, annotations]) => {\r\n    let page = document.getElementById(`pageContainer${pageNumber}`);\r\n    let svg = page.querySelector('.annotationLayer');\r\n    let canvas = page.querySelector('.canvasWrapper canvas');\r\n    let canvasContext = canvas.getContext('2d', {alpha: false});\r\n    let viewport = pdfPage.getViewport(scale, rotate);\r\n    let transform = scalePage(pageNumber, viewport, canvasContext);\r\n\r\n    // Render the page\r\n    return Promise.all([\r\n      pdfPage.render({ canvasContext, viewport, transform }),\r\n      PDFJSAnnotate.render(svg, viewport, annotations)\r\n    ]).then(() => {\r\n      // Text content is needed for a11y, but is also necessary for creating\r\n      // highlight and strikeout annotations which require selecting text.\r\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\r\n        return new Promise((resolve, reject) => {\r\n          // Render text layer for a11y of text content\r\n          let textLayer = page.querySelector(`.textLayer`);\r\n          let textLayerFactory = new PDFJS.DefaultTextLayerFactory();\r\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(textLayer, pageNumber -1, viewport);\r\n          textLayerBuilder.setTextContent(textContent);\r\n          textLayerBuilder.render();\r\n\r\n          // Enable a11y for annotations\r\n          // Timeout is needed to wait for `textLayerBuilder.render`\r\n          setTimeout(() => {\r\n            try {\r\n              renderScreenReaderHints(annotations.annotations);\r\n              resolve();\r\n            } catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        });\r\n      });\r\n    }).then(() => {\r\n      // Indicate that the page was loaded\r\n      page.setAttribute('data-loaded', 'true');\r\n\r\n      return [pdfPage, annotations];\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Scale the elements of a page.\r\n *\r\n * @param {Number} pageNumber The page number to be scaled\r\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\r\n * @param {Object} context The canvas context that the PDF page is rendered to\r\n * @return {Array} The transform data for rendering the PDF page\r\n */\r\nfunction scalePage(pageNumber, viewport, context) {\r\n  let page = document.getElementById(`pageContainer${pageNumber}`);\r\n  let canvas = page.querySelector('.canvasWrapper canvas');\r\n  let svg = page.querySelector('.annotationLayer');\r\n  let wrapper = page.querySelector('.canvasWrapper');\r\n  let textLayer = page.querySelector('.textLayer');\r\n  let outputScale = getOutputScale(context);\r\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\r\n  let sfx = approximateFraction(outputScale.sx);\r\n  let sfy = approximateFraction(outputScale.sy);\r\n\r\n  // Adjust width/height for scale\r\n  page.style.visibility = '';\r\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\r\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\r\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\r\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\r\n  svg.setAttribute('width', viewport.width);\r\n  svg.setAttribute('height', viewport.height);\r\n  svg.style.width = `${viewport.width}px`;\r\n  svg.style.height = `${viewport.height}px`;\r\n  page.style.width = `${viewport.width}px`;\r\n  page.style.height = `${viewport.height}px`;\r\n  wrapper.style.width = `${viewport.width}px`;\r\n  wrapper.style.height = `${viewport.height}px`;\r\n  textLayer.style.width = `${viewport.width}px`;\r\n  textLayer.style.height = `${viewport.height}px`;\r\n\r\n  return transform;\r\n}\r\n\r\n/**\r\n * The following methods are taken from mozilla/pdf.js and as such fall under\r\n * the Apache License (http://www.apache.org/licenses/).\r\n *\r\n * Original source can be found at mozilla/pdf.js:\r\n * https://github.com/mozilla/pdf.js/blob/master/web/ui_utils.js\r\n */\r\n\r\n/**\r\n * Approximates a float number as a fraction using Farey sequence (max order\r\n * of 8).\r\n *\r\n * @param {Number} x Positive float number\r\n * @return {Array} Estimated fraction: the first array item is a numerator,\r\n *                 the second one is a denominator.\r\n */\r\nfunction approximateFraction(x) {\r\n  // Fast path for int numbers or their inversions.\r\n  if (Math.floor(x) === x) {\r\n    return [x, 1];\r\n  }\r\n\r\n  const xinv = 1 / x;\r\n  const limit = 8;\r\n  if (xinv > limit) {\r\n    return [1, limit];\r\n  } else if (Math.floor(xinv) === xinv) {\r\n    return [1, xinv];\r\n  }\r\n\r\n  const x_ = x > 1 ? xinv : x;\r\n  \r\n  // a/b and c/d are neighbours in Farey sequence.\r\n  let a = 0, b = 1, c = 1, d = 1;\r\n  \r\n  // Limit search to order 8.\r\n  while (true) {\r\n    // Generating next term in sequence (order of q).\r\n    let p = a + c, q = b + d;\r\n    if (q > limit) {\r\n      break;\r\n    }\r\n    if (x_ <= p / q) {\r\n      c = p; d = q;\r\n    } else {\r\n      a = p; b = q;\r\n    }\r\n  }\r\n\r\n  // Select closest of neighbours to x.\r\n  if (x_ - a / b < c / d - x_) {\r\n    return x_ === x ? [a, b] : [b, a];\r\n  } else {\r\n    return x_ === x ? [c, d] : [d, c];\r\n  }\r\n}\r\n\r\nfunction getOutputScale(ctx) {\r\n  let devicePixelRatio = window.devicePixelRatio || 1;\r\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\r\n                          ctx.mozBackingStorePixelRatio ||\r\n                          ctx.msBackingStorePixelRatio ||\r\n                          ctx.oBackingStorePixelRatio ||\r\n                          ctx.backingStorePixelRatio || 1;\r\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\r\n  return {\r\n    sx: pixelRatio,\r\n    sy: pixelRatio,\r\n    scaled: pixelRatio !== 1\r\n  };\r\n}\r\n\r\nfunction roundToDivide(x, div) {\r\n  let r = x % div;\r\n  return r === 0 ? x : Math.round(x - r + div);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/UI/page.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  getOffset,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\nfunction signatureFun() { }\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n    try {\r\n        let selection = window.getSelection();\r\n        let range = selection.getRangeAt(0);\r\n        let rects = range.getClientRects();\r\n\r\n        if (rects.length > 0 && rects[0].width > 0 && rects[0].height > 0) {\r\n            return rects;\r\n        }\r\n    } catch (e) { }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n    let svg;\r\n    if (_type !== 'sign' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n        return;\r\n    }\r\n\r\n    let rect = svg.getBoundingClientRect();\r\n    originY = e.clientY;\r\n    originX = e.clientX;\r\n\r\n    overlay = document.createElement('div');\r\n    overlay.style.position = 'absolute';\r\n    overlay.style.top = `${originY - rect.top}px`;\r\n    overlay.style.left = `${originX - rect.left}px`;\r\n    overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n\r\n    overlay.style.borderRadius = '3px';\r\n    svg.parentNode.appendChild(overlay);\r\n\r\n    document.addEventListener('mousemove', handleDocumentMousemove);\r\n    disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n    let rect = svg.getBoundingClientRect();\r\n\r\n    if (originX + (e.clientX - originX) < rect.right) {\r\n        overlay.style.width = e.clientX - originX + 'px';\r\n    }\r\n\r\n    if (originY + (e.clientY - originY) < rect.bottom) {\r\n        overlay.style.height = e.clientY - originY + 'px';\r\n    }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n    let rects;\r\n    if (_type === 'sign' && overlay) {\r\n        let _svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n        let rect = _svg.getBoundingClientRect();\r\n        saveRect(_type, [{\r\n            top: parseInt(overlay.style.top, 10) + rect.top,\r\n            left: parseInt(overlay.style.left, 10) + rect.left,\r\n            width: parseInt(overlay.style.width, 10),\r\n            height: parseInt(overlay.style.height, 10)\r\n        }]);\r\n        overlay.parentNode.removeChild(overlay);\r\n        overlay = null;\r\n\r\n        document.removeEventListener('mousemove', handleDocumentMousemove);\r\n        enableUserSelect();\r\n    }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n    // Cancel rect if Esc is pressed\r\n    if (e.keyCode === 27) {\r\n        let selection = window.getSelection();\r\n        selection.removeAllRanges();\r\n        if (overlay && overlay.parentNode) {\r\n            overlay.parentNode.removeChild(overlay);\r\n            overlay = null;\r\n            document.removeEventListener('mousemove', handleDocumentMousemove);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Save a rect annotation\r\n *\r\n * @param {String} type The type of rect (sign, highlight, strikeout)\r\n * @param {Array} rects The rects to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveRect(type, rects, color) {\r\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n    let node;\r\n    let annotation;\r\n\r\n    if (!svg) {\r\n        return;\r\n    }\r\n\r\n    let boundingRect = svg.getBoundingClientRect();\r\n\r\n    color = 'FF0000';\r\n\r\n    // Initialize the annotation\r\n    annotation = {\r\n        type: type,\r\n        color: color,\r\n        rectangles: [...rects].map((r) => {\r\n            let offset = 0;\r\n\r\n            return scaleDown(svg, {\r\n                y: r.top + offset - boundingRect.top,\r\n                x: r.left - boundingRect.left,\r\n                width: r.width,\r\n                height: r.height\r\n            });\r\n        }).filter(function (r) {\r\n            return r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1;\r\n        })\r\n    };\r\n\r\n    // Short circuit if no rectangles exist\r\n    if (annotation.rectangles.length === 0) {\r\n        return;\r\n    }\r\n\r\n    // Special treatment for area as it only supports a single rect\r\n    if (type === 'sign') {\r\n        var rect = annotation.rectangles[0];\r\n        delete annotation.rectangles;\r\n        annotation.x = rect.x;\r\n        annotation.y = rect.y;\r\n        annotation.width = rect.width;\r\n        annotation.height = rect.height;\r\n    }\r\n\r\n    var _getMetadata = getMetadata(svg);\r\n\r\n    var documentId = _getMetadata.documentId;\r\n    var pageNumber = _getMetadata.pageNumber;\r\n\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation).then(function (annotation) {\r\n        appendChild(svg, annotation);\r\n    });\r\n    // Add the annotation\r\n\r\n    document.getElementById(\"labelcursor\").click();\r\n}\r\n\r\n/**\r\n * Enable rect behavior\r\n */\r\nexport function enableSignature(type, signatureFun) {\r\n    _type = type;\r\n    if (_enabled) {\r\n        return;\r\n    }\r\n    //_signatureFun = signatureFun;\r\n    _enabled = true;\r\n    document.addEventListener('mouseup', handleDocumentMouseup);\r\n    document.addEventListener('mousedown', handleDocumentMousedown);\r\n    document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n * Disable rect behavior\r\n */\r\nexport function disableSignature() {\r\n    if (!_enabled) {\r\n        return;\r\n    }\r\n\r\n    _enabled = false;\r\n    document.removeEventListener('mouseup', handleDocumentMouseup);\r\n    document.removeEventListener('mousedown', handleDocumentMousedown);\r\n    document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/UI/signature.js","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  getOffset,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\nfunction signatureFun() { }\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n  try {\r\n      let selection = window.getSelection();\r\n      let range = selection.getRangeAt(0);\r\n      let rects = range.getClientRects();\r\n\r\n      if (rects.length > 0 && rects[0].width > 0 && rects[0].height > 0) {\r\n          return rects;\r\n      }\r\n  } catch (e) { }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n* Handle document.mousedown event\r\n*\r\n* @param {Event} e The DOM event to handle\r\n*/\r\nfunction handleDocumentMousedown(e) {\r\n  let svg;\r\n  if (_type !== 'signimg' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n      return;\r\n  }\r\n  let rect = svg.getBoundingClientRect();\r\n  originY = e.clientY;\r\n  originX = e.clientX;\r\n\r\n  overlay = document.createElement('div');\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${originY - rect.top}px`;\r\n  overlay.style.left = `${originX - rect.left}px`;\r\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = '3px';\r\n  svg.parentNode.appendChild(overlay);\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n* Handle document.mousemove event\r\n*\r\n* @param {Event} e The DOM event to handle\r\n*/\r\nfunction handleDocumentMousemove(e) {\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let rect = svg.getBoundingClientRect();\r\n\r\n  if (originX + (e.clientX - originX) < rect.right) {\r\n      overlay.style.width = e.clientX - originX + 'px';\r\n  }\r\n\r\n  if (originY + (e.clientY - originY) < rect.bottom) {\r\n      overlay.style.height = e.clientY - originY + 'px';\r\n  }\r\n}\r\n\r\n/**\r\n* Handle document.mouseup event\r\n*\r\n* @param {Event} e The DOM event to handle\r\n*/\r\nfunction handleDocumentMouseup(e) {\r\n  let rects;\r\n  if (_type === 'signimg' && overlay) {\r\n      let _svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n      let rect = _svg.getBoundingClientRect();\r\n      saveRect(_type, [{\r\n          top: parseInt(overlay.style.top, 10) + rect.top,\r\n          left: parseInt(overlay.style.left, 10) + rect.left,\r\n          width: parseInt(overlay.style.width, 10),\r\n          height: parseInt(overlay.style.height, 10)\r\n      }]);\r\n      overlay.parentNode.removeChild(overlay);\r\n      overlay = null;\r\n      document.removeEventListener('mousemove', handleDocumentMousemove);\r\n      enableUserSelect();\r\n  }\r\n}\r\n\r\n/**\r\n* Handle document.keyup event\r\n*\r\n* @param {Event} e The DOM event to handle\r\n*/\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n      let selection = window.getSelection();\r\n      selection.removeAllRanges();\r\n      if (overlay && overlay.parentNode) {\r\n          overlay.parentNode.removeChild(overlay);\r\n          overlay = null;\r\n          document.removeEventListener('mousemove', handleDocumentMousemove);\r\n      }\r\n  }\r\n}\r\n\r\n/**\r\n* Save a rect annotation\r\n*\r\n* @param {String} type The type of rect (sign, highlight, strikeout)\r\n* @param {Array} rects The rects to use for annotation\r\n* @param {String} color The color of the rects\r\n*/\r\nfunction saveRect(type, rects, color) {\r\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n  let node = void 0;\r\n  let annotation = void 0;\r\n\r\n  if (!svg) {\r\n      return;\r\n  }\r\n\r\n  let boundingRect = svg.getBoundingClientRect();\r\n\r\n  color = 'FF0000';\r\n\r\n  // Initialize the annotation\r\n  annotation = {\r\n      type: type,\r\n      color: color,\r\n      rectangles: [...rects].map((r) => {\r\n          let offset = 0;\r\n\r\n          return scaleDown(svg, {\r\n              y: r.top + offset - boundingRect.top,\r\n              x: r.left - boundingRect.left,\r\n              width: r.width,\r\n              height: r.height\r\n          });\r\n      }).filter(function (r) {\r\n          return r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1;\r\n      })\r\n  };\r\n\r\n  // Short circuit if no rectangles exist\r\n  if (annotation.rectangles.length === 0) {\r\n      return;\r\n  }\r\n\r\n  // Special treatment for area as it only supports a single rect\r\n  if (type === 'signimg') {\r\n      let rect = annotation.rectangles[0];\r\n      delete annotation.rectangles;\r\n      annotation.x = rect.x;\r\n      annotation.y = rect.y;\r\n      annotation.width = rect.width;\r\n      annotation.height = rect.height;\r\n  }\r\n\r\n  let _getMetadata = getMetadata(svg);\r\n\r\n  let documentId = _getMetadata.documentId;\r\n  let pageNumber = _getMetadata.pageNumber;\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n  .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n  });\r\n}\r\n\r\n/**\r\n* Enable rect behavior\r\n*/\r\nexport function enableSignimg(type, signatureFun) {\r\n  _type = type;\r\n  if (_enabled) {\r\n      return;\r\n  }\r\n  //_signatureFun = signatureFun;\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n* Disable rect behavior\r\n*/\r\nexport function disableSignimg() {\r\n  if (!_enabled) {\r\n      return;\r\n  }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/UI/signimg.js"],"sourceRoot":""}